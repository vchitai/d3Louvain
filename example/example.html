<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>jLouvain Example</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
    crossorigin="anonymous" />
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
    crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP"
    crossorigin="anonymous" />

  <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <script type="text/javascript" src="../jLouvain.js"></script>
  <script type="text/javascript" src="./example.js"></script>
  <script type="text/javascript" src="./data.js"></script>
  <style>
    .node {
        stroke: #fff;
        stroke-width: 1.5px;
      }
      .link {
        stroke: #999;
        stroke-opacity: 0.6;
      }
    </style>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <div class="col-12">
        <h1 class="text-center">Louvain Algorithm D3 JS Demo</h1>
      </div>
    </div>
    <div class="row">
      <div class="col-6">
        <div class="row">
          <div class="col-6">
            <label for="node_number">Enter node number: </label>
            <div class="input-group mb-3">
              <div class="input-group-prepend">
                <span class="input-group-text" id="basic-addon3"> <i class="fa fa-at" aria-hidden="true"></i>
                </span>
              </div>
              <input type="number" class="form-control" id="node_number" name="node_number" aria-describedby="basic-addon3"
                value="40">
            </div>
            <input class="btn btn-primary" type="button" value="Start" id="start_btn" />
            <input class="btn btn-primary" type="button" value="Reset" id="reset_btn" />
            <input class="btn btn-primary" type="button" value="Run Community Detection" id="comm_detect" />
          </div>
        </div>
        <div class="row">
          <div class="content-wrapper">

          </div>
        </div>
      </div>
      <div class="col-6">
        <p> Data:</p>
        <p>
          <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapseExample"
            aria-expanded="false" aria-controls="collapseExample">
            Node Data
          </button>
          <div class="collapse" id="collapseExample">
            <div class="card card-body">
              <table class="table table-hover table-bordered5">
                <thead>
                  <tr>
                    <th scope="col">Source</th>
                    <th scope="col">Target</th>
                    <th scope="col">Weight</th>
                  </tr>
                </thead>
                <tbody id="tableX">
                  <tr>
                    <td>Mark</td>
                    <td>Otto</td>
                    <td>@mdo</td>
                  </tr>
                  <tr>
                    <td>Jacob</td>
                    <td>Thornton</td>
                    <td>@fat</td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td colspan="2">Larry the Bird</td>
                    <td>@twitter</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </p>
        <p> Working:</p>
        <p>
          <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapseExample2"
            aria-expanded="false" aria-controls="collapseExample2">
            Node Data
          </button>
          <div class="collapse" id="collapseExample2">
            <div class="card card-body">
              <table class="table table-hover table-bordered5">
                <thead>
                  <tr>
                    <th scope="col">Node</th>
                    <th scope="col">Community</th>
                  </tr>
                </thead>
                <tbody id="tableY">
                  <tr>
                    <td>Mark</td>
                    <td>Otto</td>
                  </tr>
                  <tr>
                    <td>Jacob</td>
                    <td>Thornton</td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td colspan="2">Larry the Bird</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-12 d-flex justify-content-center align-items-center">
      </div>
    </div>
  </div>
</body>
<script>
  d3.select("#start_btn").on("click", function () {
    node_number = $("input#node_number").val();
    if (node_number == undefined || node_number == '') {
      alert('Enter something pls');
      return;
    }
    node_data = [];
    for (var i = 0; i < node_number; i++) {
      node_data.push(i);
    }
    var community = jLouvain()
      .nodes(node_data)
      .edges(edge_data);

    //Drawing code
    var width = 600;
    var height = 600;
    edge_data = [];
    node_data.forEach(function (x) {
      a = getRandomSubarray(node_data, getRandomInt(3));
      a.forEach(function (b) {
        edge_data.push({
          source: x,
          target: b,
          weight: getRandomFloat(2)
        })
      });
    })
    var Xstring = ""
    edge_data.forEach(function (e) {
      Xstring += "<tr><td>" + e.source + "</td><td>" + e.target + "</td><td>" + e.weight + "</td></tr>"
    })
    $("#tableX").html(Xstring);
    var original_node_data = d3.entries(node_data);
    var max_weight = d3.max(edge_data, function (d) {
      return d.weight;
    });
    var weight_scale = d3.scale
      .linear()
      .domain([0, max_weight])
      .range([1, 5]);

    var force = d3.layout
      .force()
      .charge(-100)
      .linkDistance(20)
      .size([width, height]);
    $(".content-wrapper").empty();
    var svg = d3
      .select(".content-wrapper")
      .append("svg")
      .attr("width", width)
      .attr("height", height);
    // createTable([node_data]);
    // createTableFromX(edge_data);

    force
      .nodes(original_node_data)
      .links(edge_data)
      .start();

    var link = svg
      .selectAll(".link")
      .data(edge_data)
      .enter()
      .append("line")
      .attr("class", "link")
      .style("stroke-width", function (d) {
        return weight_scale(d.weight);
      });

    var node = svg
      .selectAll(".node")
      .data(force.nodes())
      .enter()
      .append("circle")
      .attr("class", "node")
      .attr("r", 5)
      .style("fill", "#a30500")
      .call(force.drag);

    var myText = svg
      .selectAll(".mytext")
      .data(node_data)
      .enter()
      .append("text");
    //the rest of your code

    myText
      .style("fill", "#0000ff")
      .attr("width", "10")
      .attr("height", "10")
      .text(function (d) {
        return d.name;
      });
    force.on("tick", function () {
      link
        .attr("x1", function (d) {
          return d.source.x;
        })
        .attr("y1", function (d) {
          return d.source.y;
        })
        .attr("x2", function (d) {
          return d.target.x;
        })
        .attr("y2", function (d) {
          return d.target.y;
        });

      node
        .attr("cx", function (d) {
          return d.x;
        })
        .attr("cy", function (d) {
          return d.y;
        });
      myText
        .attr("x", function (d) {
          return d.x;
        })
        .attr("y", function (d) {
          return d.y;
        });
    });

    d3.select("#comm_detect").on("click", function () {
      var myVar = setInterval(function () {
        //Communnity detection on click event
        var community_assignment_result = community.nextStep();
        console.log(community_assignment_result);
        if (community_assignment_result == undefined) {
          alert("Finished");
          clearInterval(myVar);
        }
        var node_ids = Object.keys(community_assignment_result);

        console.log("Resulting Community Data", community_assignment_result);

        var Ystring = ""
        Object.keys(community_assignment_result).forEach(function (k) {
          Ystring += "<tr><td>" + k + "</td><td>" + community_assignment_result[k] + "</td></tr>"
        })
        $('#tableY').html(Ystring);
        var max_community_number = 0;
        node_ids.forEach(function (d) {
          original_node_data[d].community = community_assignment_result[d];
          max_community_number =
            max_community_number < community_assignment_result[d] ?
            community_assignment_result[d] :
            max_community_number;
        });

        console.log(max_community_number);

        var color = d3.scale
          .category20()
          .domain(d3.range([0, max_community_number]));

        d3.selectAll(".node")
          .data(original_node_data)
          .style("fill", function (d) {
            return color(d.community);
          });
      }, 100);
    });

    d3.select("#reset_btn").on("click", function () {
      d3.selectAll(".node")
        .data(original_node_data)
        .style("fill", "#a30500");
    });
  });
</script>

</html>