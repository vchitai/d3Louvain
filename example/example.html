<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>jLouvain Example</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
    crossorigin="anonymous" />
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
    crossorigin="anonymous"></script>
  <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <script type="text/javascript" src="../jLouvain.js"></script>
  <script type="text/javascript" src="./example.js"></script>
  <script type="text/javascript" src="./data.js"></script>
  <style>
    .node {
        stroke: #fff;
        stroke-width: 1.5px;
      }
      .link {
        stroke: #999;
        stroke-opacity: 0.6;
      }
    </style>
</head>

<body>
  <div class="container">
    <div id="content_wrapper">
      <input type="number" name="node_number" id="node_number" max="100" min="1" placeholder="72">
      <input class="btn btn-primary" type="button" value="Start" id="start_btn" />
      <input class="btn btn-primary" type="button" value="Reset" id="reset_btn" />
      <input class="btn btn-primary" type="button" value="Run Community Detection" id="comm_detect" />
    </div>
  </div>
</body>
<script>
  d3.select("#start_btn").on("click", function () {
    node_number = $("input#node_number").val();
    node_data = []
    for (var i = 0; i < node_number; i++) {
      node_data.push(i);
    }
    var community = jLouvain()
      .nodes(node_data)
      .edges(edge_data);

    //Drawing code
    var width = 600;
    var height = 600;

    var original_node_data = d3.entries(node_data);
    var max_weight = d3.max(edge_data, function (d) {
      return d.weight;
    });
    var weight_scale = d3.scale
      .linear()
      .domain([0, max_weight])
      .range([1, 5]);

    var force = d3.layout
      .force()
      .charge(-100)
      .linkDistance(20)
      .size([width, height]);

    var svg = d3
      .select("body")
      .append("svg")
      .attr("width", width)
      .attr("height", height);
    createTable([node_data]);
    createTableFromX(edge_data);

    force
      .nodes(original_node_data)
      .links(edge_data)
      .start();

    var link = svg
      .selectAll(".link")
      .data(edge_data)
      .enter()
      .append("line")
      .attr("class", "link")
      .style("stroke-width", function (d) {
        return weight_scale(d.weight);
      });

    var node = svg
      .selectAll(".node")
      .data(force.nodes())
      .enter()
      .append("circle")
      .attr("class", "node")
      .attr("r", 5)
      .style("fill", "#a30500")
      .call(force.drag);

    var myText = svg
      .selectAll(".mytext")
      .data(node_data)
      .enter()
      .append("text");
    //the rest of your code

    myText
      .style("fill", "#0000ff")
      .attr("width", "10")
      .attr("height", "10")
      .text(function (d) {
        return d.name;
      });
    force.on("tick", function () {
      link
        .attr("x1", function (d) {
          return d.source.x;
        })
        .attr("y1", function (d) {
          return d.source.y;
        })
        .attr("x2", function (d) {
          return d.target.x;
        })
        .attr("y2", function (d) {
          return d.target.y;
        });

      node
        .attr("cx", function (d) {
          return d.x;
        })
        .attr("cy", function (d) {
          return d.y;
        });
      myText
        .attr("x", function (d) {
          return d.x;
        })
        .attr("y", function (d) {
          return d.y;
        });
    });

    d3.select("#comm_detect").on("click", function () {
      var myVar = setInterval(function () {
        //Communnity detection on click event
        var community_assignment_result = community.nextStep();
        console.log(community_assignment_result);
        if (community_assignment_result == undefined) {
          alert("Finished");
          clearInterval(myVar);
        }
        var node_ids = Object.keys(community_assignment_result);

        console.log("Resulting Community Data", community_assignment_result);

        var max_community_number = 0;
        node_ids.forEach(function (d) {
          original_node_data[d].community = community_assignment_result[d];
          max_community_number =
            max_community_number < community_assignment_result[d]
              ? community_assignment_result[d]
              : max_community_number;
        });

        console.log(max_community_number);

        var color = d3.scale
          .category20()
          .domain(d3.range([0, max_community_number]));

        d3.selectAll(".node")
          .data(original_node_data)
          .style("fill", function (d) {
            return color(d.community);
          });
      }, 100);
    });

    d3.select("#reset_btn").on("click", function () {
      d3.selectAll(".node")
        .data(original_node_data)
        .style("fill", "#a30500");
    });
  });
</script>

</html>